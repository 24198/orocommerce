services:
    #EventListeners
    oro_seo.event_listener.product_form_view:
        class: 'Oro\Bundle\SEOBundle\EventListener\ProductFormViewListener'
        arguments:
            - '@request_stack'
            - '@translator'
            - '@oro_entity.doctrine_helper'
        tags:
            - { name: kernel.event_listener, event: oro_ui.scroll_data.before.product-view, method: onProductView }
            - { name: kernel.event_listener, event: oro_ui.scroll_data.before.product-edit, method: onProductEdit }

    oro_seo.event_listener.category_form_view:
        class: 'Oro\Bundle\SEOBundle\EventListener\CategoryFormViewListener'
        arguments:
            - '@request_stack'
            - '@translator'
            - '@oro_entity.doctrine_helper'
        tags:
            - { name: kernel.event_listener, event: oro_ui.scroll_data.before.category-edit, method: onCategoryEdit }

    oro_seo.event_listener.page_form_view:
        class: 'Oro\Bundle\SEOBundle\EventListener\PageFormViewListener'
        arguments:
            - '@request_stack'
            - '@translator'
            - '@oro_entity.doctrine_helper'
        tags:
            - { name: kernel.event_listener, event: oro_ui.scroll_data.before.page-view, method: onPageView }
            - { name: kernel.event_listener, event: oro_ui.scroll_data.before.page-edit, method: onPageEdit }

    oro_seo.event_listener.content_node_form_view:
        class: 'Oro\Bundle\SEOBundle\EventListener\ContentNodeFormViewListener'
        arguments:
            - '@request_stack'
            - '@translator'
            - '@oro_entity.doctrine_helper'
        tags:
            - { name: kernel.event_listener, event: oro_ui.scroll_data.before.web-catalog-tree-view, method: onContentNodeView }
            - { name: kernel.event_listener, event: oro_ui.scroll_data.before.web-catalog-tree-edit, method: onContentNodeEdit }

    oro_seo.layout.data_provider.seo_data:
        class: Oro\Bundle\SEOBundle\Layout\DataProvider\SeoDataProvider
        arguments:
            - '@oro_locale.helper.localization'
            - '@request_stack'
            - '@property_accessor'
        tags:
            - { name: layout.data_provider, alias: seo }

    #Forms
    oro_seo.form.extension.page_type:
        class: 'Oro\Bundle\SEOBundle\Form\Extension\PageFormExtension'
        tags:
            - { name: form.type_extension, alias: oro_cms_page }

    oro_seo.form.extension.product_type:
        class: 'Oro\Bundle\SEOBundle\Form\Extension\ProductFormExtension'
        tags:
            - { name: form.type_extension, alias: oro_product }

    oro_seo.form.extension.category_type:
        class: 'Oro\Bundle\SEOBundle\Form\Extension\CategoryFormExtension'
        tags:
            - { name: form.type_extension, alias: oro_catalog_category }

    oro_seo.event_listener.website_search_index:
        class: 'Oro\Bundle\SEOBundle\EventListener\ProductSearchIndexListener'
        arguments:
            - '@oro_entity.doctrine_helper'
            - '@oro_website.provider.website_localization'
            - '@oro_website_search.manager.website_context_manager'
        tags:
            - { name: kernel.event_listener, event: oro_website_search.event.index_entity.product, method: onWebsiteSearchIndex }

    oro_seo.form.extension.content_node_type:
        class: 'Oro\Bundle\SEOBundle\Form\Extension\ContentNodeFormExtension'
        tags:
            - { name: form.type_extension, alias: oro_web_catalog_content_node }

    oro_seo.provider.content_node_content_variant_provider:
        class: Oro\Bundle\SEOBundle\Provider\ContentNodeContentVariantProvider
        arguments:
            - '@oro_locale.helper.localization'
        tags:
            - { name: oro_web_catalog.content_variant_provider }

    oro_seo.provider.url_items_provider_registry:
        class: Oro\Bundle\SEOBundle\Provider\UrlItemsProviderRegistry

    oro_seo.sitemap.provider.sitemap_files_provider:
        class: Oro\Bundle\SEOBundle\Sitemap\Provider\SitemapFilesProvider
        arguments:
            - '@oro_seo.sitemap.filesystem_adapter'
            - '@oro_redirect.generator.canonical_url'
            - '/web/sitemaps'

    oro_seo.sitemap.filesystem_adapter:
        class: Oro\Bundle\SEOBundle\Sitemap\Filesystem\SitemapFilesystemAdapter
        arguments:
            - '@filesystem'
            - '@oro_seo.sitemap.sitemap_file_writer'
            - '%kernel.root_dir'

    oro_seo.sitemap.sitemap_url_dumper:
        class: Oro\Bundle\SEOBundle\Sitemap\Dumper\SitemapDumper
        arguments:
            - '@oro_seo.provider.url_items_provider_registry'
            - '@oro_seo.sitemap.sitemap_storage_factory'
            - '@oro_seo.sitemap.filesystem_adapter'

    oro_seo.sitemap.sitemap_index_dumper:
        class: Oro\Bundle\SEOBundle\Sitemap\Dumper\SitemapIndexDumper
        arguments:
            - '@oro_seo.sitemap.provider.sitemap_files_provider'
            - '@oro_seo.sitemap.sitemap_storage_factory'
            - '@oro_seo.sitemap.filesystem_adapter'

    oro_seo.form.type.sitemap_changefreq:
        class: Oro\Bundle\SEOBundle\Form\Type\SitemapChangefreqType
        tags:
            - { name: form.type, alias: oro_sitemap_changefreq }

    oro_seo.form.type.sitemap_priority:
        class: Oro\Bundle\SEOBundle\Form\Type\SitemapPriorityType
        tags:
            - { name: form.type, alias: oro_sitemap_priority }

    oro_seo.provider.abstract_url_items_provider:
        class: Oro\Bundle\SEOBundle\Provider\AbstractUrlItemsProvider
        abstract: true
        arguments:
            - '@oro_redirect.generator.canonical_url'
            - '@oro_config.manager'
            - '@event_dispatcher'
            - '@oro_entity.doctrine_helper'
            - '@oro_featuretoggle.checker.feature_checker'

    oro_seo.provider.product_url_items_provider:
        class: Oro\Bundle\SEOBundle\Provider\ProductUrlItemsProvider
        parent: oro_seo.provider.abstract_url_items_provider
        tags:
            - { name: oro_seo.sitemap_url_provider }

    oro_seo.provider.category_url_items_provider:
        class: Oro\Bundle\SEOBundle\Provider\CategoryUrlItemsProvider
        parent: oro_seo.provider.abstract_url_items_provider
        tags:
            - { name: oro_seo.sitemap_url_provider }

    oro_seo.provider.cms_page_url_items_provider:
        class: Oro\Bundle\SEOBundle\Provider\CmsPageUrlItemsProvider
        parent: oro_seo.provider.abstract_url_items_provider
        tags:
            - { name: oro_seo.sitemap_url_provider }

    oro_seo.sitemap.sitemap_storage_factory:
        public: false
        class: Oro\Bundle\SEOBundle\Sitemap\Storage\SitemapStorageFactory

    oro_seo.sitemap.sitemap_file_writer:
        class: Oro\Bundle\SEOBundle\Sitemap\Filesystem\SitemapFileWriter
        arguments:
            - '@filesystem'
            - '@logger'
