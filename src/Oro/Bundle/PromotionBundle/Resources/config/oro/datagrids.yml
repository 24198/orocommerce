datagrids:
    promotion-select-grid:
        acl_resource: oro_promotion_view
        extended_entity_name: '%oro_promotion.entity.promotion.class%'
        options:
            entityHint: 'promotions'
        source:
            type: orm
            query:
                select:
                    - promotion.id
                    - rule.name
                    - promotion.useCoupons
                    - promotion.createdAt
                    - promotion.updatedAt
                    - rule.enabled
                from:
                    - { table: '%oro_promotion.entity.promotion.class%', alias: promotion }
                join:
                    inner:
                        - { join: promotion.rule, alias: rule}
        properties:
            id: ~
        columns:
            name:
                label: oro.promotion.rule.name.label
#            TODO: uncomment after BB-9489
#            useCoupons:
#                label: oro.promotion.use_coupons.label
#                frontend_type: boolean
            createdAt:
                label: oro.ui.created_at
                frontend_type: datetime
            updatedAt:
                label: oro.ui.updated_at
                frontend_type: datetime
            enabled:
                label: oro.promotion.rule.enabled.label
                frontend_type: boolean
        sorters:
            columns:
                name:
                    data_name: rule.name
#                TODO: uncomment after BB-9489
#                useCoupons:
#                    data_name: promotion.useCoupons
                createdAt:
                    data_name: promotion.createdAt
                updatedAt:
                    data_name: promotion.updatedAt
                enabled:
                    data_name: rule.enabled
        filters:
            columns:
                name:
                    type: string
                    data_name: rule.name
#                TODO: uncomment after BB-9489
#                useCoupons:
#                    type: boolean
#                    data_name: promotion.useCoupons
                createdAt:
                    type:      datetime
                    data_name: promotion.createdAt
                updatedAt:
                    type:      datetime
                    data_name: promotion.updatedAt
                enabled:
                    type:      boolean
                    data_name: rule.enabled

    promotion-grid:
        extends: promotion-select-grid
        properties:
            view_link:
                type:  url
                route: oro_promotion_view
                params:
                    - id
        actions:
            view:
                type:          navigate
                label:         oro.grid.action.view
                link:          view_link
                icon:          eye
                acl_resource:  oro_promotion_view
                rowAction:     true

    promotion-products-collection-grid:
        extends: products-select-grid-base
        options:
            export: true

    promotion-order-applied-discount-grid:
        acl_resource: oro_promotion_view
        source:
            type: orm
            query:
                select:
                    - SUM(discount.amount) AS discountAmount
                    - discount.promotionName AS name
                    - discount.currency AS currency
                from:
                    - { table: OroPromotionBundle:AppliedDiscount, alias: discount }
                where:
                    and:
                        - discount.order = :orderId
                groupBy: discount.promotionName, discount.currency
            bind_parameters:
                - orderId
        columns:
            name:
                label: oro.order.promotions.applied_discount.name
            discountAmount:
                label: oro.order.promotions.applied_discount.amount
                type: twig
                frontend_type: html
                template: OroPromotionBundle:AppliedDiscount/Datagrid:amount.html.twig
        sorters:
            columns:
                name:
                    data_name: discount.promotionName
                discountAmount:
                    data_name: discountAmount
        filters:
            columns:
                name:
                    type: string
                    data_name: discount.promotionName
                discountAmount:
                    type: number-range
                    data_name: discountAmount
                    filter_by_having: true
