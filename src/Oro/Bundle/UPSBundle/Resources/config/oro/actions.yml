operations:
    oro_integration_deactivate:
        preactions:
            - '@assign_constant_value':
                attribute: $.upsType
                value: Oro\Bundle\UPSBundle\Provider\ChannelType::TYPE
        preconditions:
            '@and':
                - '@not_equal': [$type, $.upsType]

    oro_integration_invalidate_cache:
        label: oro.ups.form.invalidate_cache.label
        routes:
            - oro_integration_update
        acl_resource: [UPDATE, entity:Oro\Bundle\IntegrationBundle\Entity\Channel]
        button_options:
            icon: fa-clock-o
        frontend_options:
            template: OroUPSBundle:Action:invalidateCache.html.twig
            title: oro.ups.form.invalidate_cache.title
            options:
                width: 505
                modal: false
                stateEnabled: false
                incrementalPosition: false
                allowMaximize: false
                allowMinimize: false
                maximizedHeightDecreaseBy: minimize-bar
        attributes:
            invalidateType:
                label: oro.ups.form.invalidate_cache.label
                type: string
            invalidateCacheAt:
                label: oro.ups.form.invalidate_cache_at.label
                type: entity
                property_path: data.transport.invalidateCacheAt
                options:
                    class: Oro\Bundle\IntegrationBundle\Entity\Channel
            invalidateNow:
                label: 'invalidate_cache.action.invalidate_now'
                type: entity
                property_path: data.transport.invalidateCacheAt
                options:
                    class: Oro\Bundle\IntegrationBundle\Entity\Channel
        form_options:
            attribute_fields:
                invalidateType:
                    form_type: choice
                    options:
                        placeholder: false
                        choices:
                            scheduled: oro.ups.form.invalidate_cache.type.scheduled
                            immediate: oro.ups.form.invalidate_cache.type.immediate
                invalidateCacheAt:
                    form_type: Oro\Bundle\FormBundle\Form\Type\OroDateTimeType
                invalidateNow:
                    form_type: hidden
            attribute_default_values:
                invalidateCacheAt: $.data.transport.invalidateCacheAt
        form_init:
            - '@assign_value': [$.invalidateCacheAt, $.data.transport.invalidateCacheAt]
        preactions:
            - '@assign_constant_value':
                attribute: $.upsType
                value: Oro\Bundle\UPSBundle\Provider\ChannelType::TYPE
        actions:
            - '@call_service_method':
                service: oro_ups.handler.invalidate_cache_at
                method: process
                method_parameters: [$.data, $.form]
            - '@flash_message':
                conditions:
                    '@not_empty': $.invalidateNow
                message: oro.ups.form.invalidate_cache.flash.invalidate_success
                type: 'success'
            - '@flash_message':
                conditions:
                    '@empty': $.invalidateNow
                message: oro.ups.form.invalidate_cache.flash.save_success
                type: 'success'
        preconditions:
            '@equal': [$type, $.upsType]

    oro_ups_integration_deactivate:
        extends: oro_integration_deactivate
        for_all_entities: false
        for_all_datagrids: false
        replace:
            - preactions
            - preconditions
            - frontend_options
        preactions:
            - '@assign_constant_value':
                attribute: $.upsType
                value: Oro\Bundle\UPSBundle\Provider\ChannelType::TYPE
            - '@call_service_method':
                attribute: $.actionAllowed
                service: oro_integration.utils.edit_mode
                method: isSwitchEnableAllowed
                method_parameters: [$.data.editMode]
            - '@call_service_method':
                attribute: $.methodIdentifier
                service: oro_ups.method.identifier_generator.method
                method: generateIdentifier
                method_parameters: [$.data]
            - '@call_service_method':
                attribute: $.linkGrid
                service: oro_shipping.helper.filtered_datagrid_route
                method: generate
                method_parameters:  [{'methodsConfigs': $.methodIdentifier}]
        preconditions:
            '@and':
                - '@equal': [$type, $.upsType]
                - '@equal': [$.actionAllowed, true]
                - '@equal': [$.data.enabled, true]
        frontend_options:
            confirmation:
                title: oro.ups.rule.deactivate.title
                okText: oro.ups.rule.deactivate.button.okText
                message: oro.ups.rule.deactivate.message
                message_parameters:
                    linkGrid: $.linkGrid
                component: oroui/js/standart-confirmation

    oro_ups_integration_delete:
        extends: oro_integration_delete
        for_all_entities: false
        for_all_datagrids: false
        replace:
            - preactions
            - preconditions
            - frontend_options
        preactions:
            - '@assign_constant_value':
                attribute: $.upsType
                value: Oro\Bundle\UPSBundle\Provider\ChannelType::TYPE
            - '@call_service_method':
                service: oro_integration.utils.edit_mode
                method: isEditAllowed
                method_parameters: [$.data.editMode]
                attribute: $.actionAllowed
            - '@call_service_method':
                attribute: $.methodIdentifier
                service: oro_ups.method.identifier_generator.method
                method: generateIdentifier
                method_parameters: [$.data]
            - '@call_service_method':
                attribute: $.linkGrid
                service: oro_shipping.helper.filtered_datagrid_route
                method: generate
                method_parameters:  [{'methodsConfigs': $.methodIdentifier}]
        preconditions:
            '@and':
                - '@equal': [$type, $.upsType]
                - '@equal': [$.actionAllowed, true]
        frontend_options:
            confirmation:
                title: oro.ups.rule.delete.title
                okText: oro.ups.rule.delete.button.okText
                message: oro.ups.rule.delete.message
                message_parameters:
                    linkGrid: $.linkGrid
                component: oroui/js/standart-confirmation
