operations:
    oro_dpd_setorder:
        label: oro.dpd.actions.set_order.widgets.set_order.label
        routes:
            - oro_order_view
        acl_resource: [UPDATE, entity:Oro\Bundle\OrderBundle\Entity\Order]
        button_options:
            icon: fa-list-alt
        frontend_options:
            title: oro.dpd.actions.set_order.frontend_options.title
            confirmation:
                title: oro.dpd.actions.set_order.frontend_options.confirmation.title
                okText: oro.dpd.actions.set_order.frontend_options.confirmation.ok_text
                message: oro.dpd.actions.set_order.frontend_options.confirmation.message
                message_parameters:
                    entityLabel: $.entityLabel
        preconditions:
            '@and':
                - '@not_blank': $.data
                - '@shipped_with_dpd': $.data.shippingMethod
        actions:
            - '@call_service_method':
                attribute: $.result
                service: oro_dpd.handler.order_shipping_dpd
                method: process
                method_parameters: [$.data]
            - '@flash_message':
                conditions:
                    '@equal': ['$.result[successful]', true]
                message: oro.dpd.actions.set_order.flash.success
                type: 'success'
            - '@traverse':
                conditions:
                    '@and':
                        - '@equal': ['$.result[successful]', false]
                        - '@not_empty': $.result[errors]
                parameters:
                    array: $.result[errors]
                    value: $.errorMsgTemp
                    actions:
                        - '@flash_message':
                            message: $.errorMsgTemp
                            type: 'error'
            - '@refresh_grid': order-shipping-trackings-grid
            - '@refresh_grid': attachment-grid