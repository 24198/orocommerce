{% import 'OroUIBundle::macros.html.twig' as UI %}
{% import 'OroEntityConfigBundle::macros.html.twig' as entityConfig %}

<div class="widget-content">
    <div class="row-fluid form-horizontal">
        <div class="responsive-block">
            {{ UI.renderProperty('orob2b.pricing.pricelist.name.label'|trans, entity.name) }}

            {% if entity.currencies %}
                {% set currencies = [] %}
                {% for currency in entity.currencies %}
                    {% set currencies = currencies|merge([currency|oro_localized_currency_name]) %}
                {% endfor %}
                {{ UI.renderHtmlProperty('orob2b.pricing.pricelist.currencies.label'|trans, UI.renderList(currencies)) }}
            {% endif %}

            {% if not entity.schedules.isEmpty() %}
                {{ UI.renderHtmlProperty('orob2b.pricing.pricelist.schedule.label'|trans, _self.schedule(entity.schedules)) }}
            {% endif %}
        </div>
    </div>
</div>

{% macro schedule(schedules) %}
    {% set now = date('now', 'UTC') %}
    <ul>
        {% set activityShown = false %}
        {% for schedule in schedules %}
            {% if schedule.activeAt %}
                {% if schedule.activeAt < now %}
                    <li>
                        {{ 'orob2b.pricing.pricelist_schedule.was_activated'|trans({'%date%': schedule.activeAt|oro_format_datetime}) }}
                    </li>
                    {% if not schedule.deactivateAt or (schedule.deactivateAt and schedule.deactivateAt > now) %}
                        {% set activityShown = true %}
                        <li>
                            {{ 'orob2b.pricing.pricelist_schedule.active_now'|trans }}
                        </li>
                    {% endif %}
                    {% if schedule.deactivateAt %}
                        {% if schedule.deactivateAt > now %}
                        <li>
                            {{ 'orob2b.pricing.pricelist_schedule.will_be_deacitivated'|trans({'%date%': schedule.activeAt|oro_format_datetime}) }}
                        </li>
                        {% else %}
                            <li>
                                {{ 'orob2b.pricing.pricelist_schedule.was_deactivated'|trans({'%date%': schedule.activeAt|oro_format_datetime}) }}
                            </li>
                        {% endif %}
                    {% endif %}
                {% else %}
                    {% if not activityShown %}
                        {% set activityShown = true %}
                        <li>
                            {{ 'orob2b.pricing.pricelist_schedule.not_active_now'|trans }}
                        </li>
                    {% endif %}
                    <li>
                        {{ 'orob2b.pricing.pricelist_schedule.will_be_acitivated'|trans({'%date%': schedule.activeAt|oro_format_datetime}) }}
                    </li>
                    {% if schedule.deactivateAt %}
                        <li>
                            {{ 'orob2b.pricing.pricelist_schedule.will_be_deacitivated'|trans({'%date%': schedule.activeAt|oro_format_datetime}) }}
                        </li>
                    {% endif %}
                {% endif %}
            {% endif %}
        {% endfor %}
    </ul>
{% endmacro %}
