method: getTax
reference: simple_order
configuration:
    use_as_base_by_default: destination
    destination: shipping_address
    start_calculation_on: total
    start_calculation_with: row_total
    product_prices_include_tax: false
databaseBefore:
    'OroB2B\Bundle\OrderBundle\Entity\Order':
        simple_order:
            poNumber: { property_value: simple_order }
            account: { class: 'OroB2B\Bundle\AccountBundle\Entity\Account', query: {} }
            shippingAddress:
                class: 'OroB2B\Bundle\OrderBundle\Entity\OrderAddress'
                property_value:
                    country: { class: 'Oro\Bundle\AddressBundle\Entity\Country', query: { iso2Code: 'US' } }
                    region: { class: 'Oro\Bundle\AddressBundle\Entity\Region', query: { combinedCode: 'US-CA' } }
    'OroB2B\Bundle\OrderBundle\Entity\OrderLineItem':
        order_line_item_1:
            productSku: { property_value: order_line_item_1 }
            order: { reference: simple_order }
            quantity: { property_value: 41 }
            price: { class: 'Oro\Bundle\CurrencyBundle\Model\Price', property_value: { value: '3.42', currency: USD } }
        order_line_item_2:
            productSku: { property_value: order_line_item_2 }
            order: { reference: simple_order }
            quantity: { property_value: 15 }
            price: { class: 'Oro\Bundle\CurrencyBundle\Model\Price', property_value: { value: '8.55', currency: USD } }
        order_line_item_3:
            productSku: { property_value: order_line_item_3 }
            order: { reference: simple_order }
            quantity: { property_value: 13 }
            price: { class: 'Oro\Bundle\CurrencyBundle\Model\Price', property_value: { value: '18.05', currency: USD } }
        order_line_item_4:
            productSku: { property_value: order_line_item_4 }
            order: { reference: simple_order }
            quantity: { property_value: 35 }
            price: { class: 'Oro\Bundle\CurrencyBundle\Model\Price', property_value: { value: '24.80', currency: USD } }
    'OroB2B\Bundle\TaxBundle\Entity\TaxRule':
        tax_rule.TAX3:
            tax: { class: 'OroB2B\Bundle\TaxBundle\Entity\Tax', query: { code: 'TAX3' } }
            taxJurisdiction: { class: 'OroB2B\Bundle\TaxBundle\Entity\TaxJurisdiction', query: { code: 'TAX3' } }
expectedResult:
    total:
        includingTax: '1611.07'
        excludingTax: '1371.12'
        taxAmount: '239.95'
        adjustment: '-0.164625'
    taxes:
        - { tax: 'TAX1', rate: '0.1', taxable_amount: '1371.12', tax_amount: '137.11' }
        - { tax: 'TAX3', rate: '0.075', taxable_amount: '1371.12', tax_amount: '102.85' }
    items:
        -
            row:
                includingTax: '164.76'
                excludingTax: '140.22'
                taxAmount: '24.54'
                adjustment: '-0.0615'
            unit:
                includingTax: '4.02'
                excludingTax: '3.42'
                taxAmount: '0.6'
                adjustment: '-0.0015'
            taxes:
                - { tax: 'TAX1', rate: '0.1', taxable_amount: '140.22', tax_amount: '14.02' }
                - { tax: 'TAX3', rate: '0.075', taxable_amount: '140.22', tax_amount: '10.52' }
        -
            row:
                includingTax: '150.69'
                excludingTax: '128.25'
                taxAmount: '22.44'
                adjustment: '-0.05625'
            unit:
                includingTax: '10.05'
                excludingTax: '8.55'
                taxAmount: '1.5'
                adjustment: '-0.00375'
            taxes:
                - { tax: 'TAX1', rate: '0.1', taxable_amount: '128.25', tax_amount: '12.83' }
                - { tax: 'TAX3', rate: '0.075', taxable_amount: '128.25', tax_amount: '9.62' }
        -
            row:
                includingTax: '275.71'
                excludingTax: '234.65'
                taxAmount: '41.06'
                adjustment: '-0.01625'
            unit:
                includingTax: '21.21'
                excludingTax: '18.05'
                taxAmount: '3.16'
                adjustment: '-0.00125'
            taxes:
                - { tax: 'TAX1', rate: '0.1', taxable_amount: '234.65', tax_amount: '23.47' }
                - { tax: 'TAX3', rate: '0.075', taxable_amount: '234.65', tax_amount: '17.6' }
        -
            row:
                includingTax: '1019.9'
                excludingTax: '868'
                taxAmount: '151.9'
                adjustment: '-0.030625'
            unit:
                includingTax: '29.13'
                excludingTax: '24.8'
                taxAmount: '4.34'
                adjustment: '-0.000875'
            taxes:
                - { tax: 'TAX1', rate: '0.1', taxable_amount: '868', tax_amount: '86.8' }
                - { tax: 'TAX3', rate: '0.075', taxable_amount: '868', tax_amount: '65.1' }
