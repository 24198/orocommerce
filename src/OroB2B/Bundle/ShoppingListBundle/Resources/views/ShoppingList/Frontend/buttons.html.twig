{% macro addToCurrentButton(options) %}
    {% import _self as buttons %}
    {{ buttons.getButton(options|merge({
        defaultLabel: 'orob2b.shoppinglist.entity_label'|trans,
        actionLabel: 'orob2b.shoppinglist.actions.add_to_shopping_list'|trans
    })) }}
{% endmacro %}

{% macro addToButton(options) -%}
    {% import _self as buttons %}
    {{ buttons.getButton(options|merge({
        actionLabel: 'orob2b.shoppinglist.actions.add_to_shopping_list'|trans
    })) }}
{% endmacro %}

{% macro addToNewButton(options) %}
    {% import _self as buttons %}
    {{ buttons.getButton(options|merge({
        actionLabel: 'orob2b.shoppinglist.actions.add_to_new_shopping_list'|trans,
        dataAttributes: options.dataAttributes|merge({intention: 'new'})
    })) }}
{% endmacro %}

{% macro buttonTemplate(options) %}
    {% import 'OroB2BFrontendBundle:layouts/default:utils.html.twig' as utils %}
    {% import _self as buttons %}
    {% spaceless %}
        {{ utils.underscoreRaw(buttons.addToCurrentButton(options|merge({
            shoppingList: {
                id: '<%= id %>',
                label: '<%= label %>'
            }
        }))) }}
    {% endspaceless %}
{% endmacro %}

{% macro getButton(options) %}
    {% import 'OroUIBundle::macros.html.twig' as UI %}

    {% set options = {
        shoppingList: null,
        defaultLabel: '',
        aCss: ''
    }|merge(options) %}

    {% set shoppingListId = options.shoppingList ? options.shoppingList.id : null %}
    {% set shoppingListLabel = options.shoppingList ? options.shoppingList.label : options.defaultLabel %}

    {% set dataAttributes = options.dataAttributes %}
    {% if options.dataUrl %}
        {% set dataAttributes = dataAttributes|merge({
            urlOptions: (options.dataUrlOptions|merge({shoppingListId: shoppingListId}))|json_encode
        }) %}
    {% endif %}

    {% set buttonOptions = {
        'dataAttributes': dataAttributes,
        'aCss': 'direct-link add-to-shopping-list-button ' ~ options.aCss,
        'dataId': shoppingListId,
        'label' : options.actionLabel|replace({'{{ shoppingList }}': shoppingListLabel})
    } %}
    {% if options.dataUrl %}
        {% set buttonOptions = buttonOptions|merge({
            'dataUrl': options.dataUrl,
        }) %}
    {% endif %}

    {{ UI.clientButton(buttonOptions) }}
{% endmacro %}

{% macro createAddToShoppingListButton(options) %}
    {% import 'OroUIBundle::macros.html.twig' as UI %}
    {% import _self as buttons %}
    {% set buttonsHtml %}
        {% set existingShoppingLists = [] %}
        {% for shoppingList in options.shoppingLists %}
            {% if shoppingList.current %}
                {{ buttons.addToCurrentButton(options.current|merge({shoppingList: shoppingList})) }}
            {% else %}
                {%  set existingShoppingLists = existingShoppingLists|merge([shoppingList]) %}
            {% endif %}
        {% else %}
            {% set aCss = options.singleButtonACss is defined ? options.singleButtonACss : "" %}
            {{ buttons.addToCurrentButton(options.current|merge({shoppingList: null, aCss: aCss})) }}
        {% endfor %}
        {% for shoppingList in existingShoppingLists %}
            {{ buttons.addToButton(options.existing|merge({shoppingList: shoppingList})) }}
        {% endfor %}
        {% if options.shoppingLists is not empty %}
            {{ buttons.addToNewButton(options.new) }}
        {% endif %}
    {% endset %}
    {% set customOptions = {}
        |merge(options.groupContainer|default(false) ? {'groupContainer': options.groupContainer} : {} )
        |merge(options.truncateLabelLength|default(false) ? {'truncateLength': options.truncateLabelLength} : {} )
    %}
    {{ UI.pinnedDropdownButton({
        'html': buttonsHtml,
        'options': {
            'widgetModule': 'orob2bshoppinglist/js/content-processor/add-to-shopping-list-dropdown-button',
            'widgetName': 'addToShoppingListDropdownButtonProcessor',
            'addButtonEvent': 'shopping-list:created',
            'buttonTemplate': buttons.buttonTemplate(options.current),
            'truncateLength': 15
        }|merge(customOptions)
    }) }}
{% endmacro %}
