operations:
    orob2b_account_accountuser_disable:
        label: orob2b.account.action.account_user.disable
        applications: [backend]
        routes:
            - orob2b_account_account_user_view
        datagrids:
            - account-account-user-grid
        order: 10
        button_options:
            icon: icon-remove
        acl_resource: [EDIT, $.data]
        preconditions:
            @equal: [$enabled, true]
        action_groups:
            -
                name: orob2b_account_accountuser_disable
                parameters_mapping:
                    data: $.data

    orob2b_account_accountuser_enable:
        label: orob2b.account.action.account_user.enable
        applications: [backend]
        routes:
            - orob2b_account_account_user_view
        datagrids:
            - account-account-user-grid
        order: 10
        button_options:
            icon: icon-ok
        acl_resource: [EDIT, $.data]
        preconditions:
            @equal: [$enabled, false]
        action_groups:
            -
                name: orob2b_account_accountuser_enable
                parameters_mapping:
                    data: $.data

    orob2b_account_frontend_accountuser_disable:
        label: orob2b.account.action.account_user.disable
        applications: [frontend]
        routes:
            - orob2b_account_frontend_account_user_view
        datagrids:
            - frontend-account-account-user-grid
        order: 10
        button_options:
            icon: icon-remove
        acl_resource: [EDIT, $.data]
        preactions:
            - @get_active_user: $.currentUser
        preconditions:
            @and:
                - @equal: [$enabled, true]
                - @not_equal: [$id, $.currentUser.id]
        action_groups:
            -
                name: orob2b_account_frontend_accountuser_disable
                parameters_mapping:
                    data: $.data
                    current_user: $.currentUser

    orob2b_account_frontend_accountuser_enable:
        label: orob2b.account.action.account_user.enable
        applications: [frontend]
        routes:
            - orob2b_account_frontend_account_user_view
        datagrids:
            - frontend-account-account-user-grid
        order: 10
        button_options:
            icon: icon-ok
        acl_resource: [EDIT, $.data]
        preactions:
            - @get_active_user: $.currentUser
        preconditions:
            @and:
                - @equal: [$enabled, false]
                - @not_equal: [$id, $.currentUser.id]
        action_groups:
            -
                name: orob2b_account_frontend_accountuser_enable
                parameters_mapping:
                    data: $.data
                    current_user: $.currentUser

    orob2b_account_accountuser_confirm:
        label: orob2b.account.action.account_user.confirm
        routes:
            - orob2b_account_account_user_view
            - orob2b_account_frontend_account_user_view
        order: 20
        button_options:
            class: back no-hash icons-holder-text
            icon: icon-ok
        acl_resource: [EDIT, $.data]
        preconditions:
            @equal: [$confirmed, false]
        action_groups:
            -
                name: orob2b_account_accountuser_confirm
                parameters_mapping:
                    data: $.data

    orob2b_account_accountuser_sendconfirmation:
        label: orob2b.account.action.account_user.send_confirmation
        routes:
            - orob2b_account_account_user_view
            - orob2b_account_frontend_account_user_view
        order: 30
        button_options:
            class: back no-hash icons-holder-text
            icon: icon-envelope-alt
        acl_resource: [EDIT, $.data]
        preconditions:
            @equal: [$confirmed, false]
        action_groups:
            -
                name: orob2b_account_accountuser_sendconfirmation
                parameters_mapping:
                    data: $.data

action_groups:
    orob2b_account_accountuser_disable:
        parameters:
            data:
                type: OroB2B\Bundle\AccountBundle\Entity\AccountUser
        acl_resource: [EDIT, $data]
        conditions:
            @equal: [$data.enabled, true]
        actions:
            - @assign_value: [$data.enabled, false]
            - @call_service_method:
                service: orob2b_account_user.manager
                method: updateUser
                method_parameters: [$data]
            - @flash_message:
                message: orob2b.account.controller.accountuser.disabled.message
                type: 'success'

    orob2b_account_accountuser_enable:
        parameters:
            data:
                type: OroB2B\Bundle\AccountBundle\Entity\AccountUser
        acl_resource: [EDIT, $data]
        conditions:
            @equal: [$data.enabled, false]
        actions:
            - @assign_value: [$data.enabled, true]
            - @call_service_method:
                service: orob2b_account_user.manager
                method: updateUser
                method_parameters: [$data]
            - @flash_message:
                message: orob2b.account.controller.accountuser.enabled.message
                type: 'success'

    orob2b_account_frontend_accountuser_disable:
        parameters:
            data:
                type: OroB2B\Bundle\AccountBundle\Entity\AccountUser
            current_user:
                type: Symfony\Component\Security\Core\User\UserInterface
        acl_resource: [EDIT, $.data]
        conditions:
            @and:
                - @equal: [$data.enabled, true]
                - @not_equal: [$data.id, $current_user.id]
        actions:
            - @assign_value: [$data.enabled, false]
            - @call_service_method:
                service: orob2b_account_user.manager
                method: updateUser
                method_parameters: [$data]
            - @flash_message:
                message: orob2b.account.controller.accountuser.disabled.message
                type: 'success'

    orob2b_account_frontend_accountuser_enable:
        parameters:
            data:
                type: OroB2B\Bundle\AccountBundle\Entity\AccountUser
            current_user:
                type: Symfony\Component\Security\Core\User\UserInterface

        acl_resource: [EDIT, $data]
        conditions:
            @and:
                - @equal: [$data.enabled, false]
                - @not_equal: [$data.id, $current_user.id]
        actions:
            - @assign_value: [$data.enabled, true]
            - @call_service_method:
                service: orob2b_account_user.manager
                method: updateUser
                method_parameters: [$data]
            - @flash_message:
                message: orob2b.account.controller.accountuser.enabled.message
                type: 'success'

    orob2b_account_accountuser_confirm:
        parameters:
            data:
                type: OroB2B\Bundle\AccountBundle\Entity\AccountUser
        acl_resource: [EDIT, $data]
        conditions:
            @equal: [$data.confirmed, false]
        actions:
            - @call_service_method:
                service: orob2b_account_user.manager
                method: confirmRegistration
                method_parameters: [$data]
            - @call_service_method:
                service: orob2b_account_user.manager
                method: updateUser
                method_parameters: [$data]
            - @flash_message:
                message: orob2b.account.controller.accountuser.confirmed.message
                type: 'success'

    orob2b_account_accountuser_sendconfirmation:
        parameters:
            data:
                type: OroB2B\Bundle\AccountBundle\Entity\AccountUser
        acl_resource: [EDIT, $data]
        conditions:
            @equal: [$data.confirmed, false]
        actions:
            - @call_service_method:
                service: orob2b_account_user.manager
                method: sendConfirmationEmail
                method_parameters: [$data]
            - @flash_message:
                message: orob2b.account.controller.accountuser.confirmation_sent.message
                type: 'success'
