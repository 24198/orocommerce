{% extends '@OroB2BFrontend/layouts/default/form_theme.html.twig' %}

{%- block form_label -%}
    {% set modifier = "__form__payment-label" %}
    {{ parent() }}
{%- endblock form_label -%}

{% block _orob2b_payment_credit_card_payment_credit_card_cvv_widget %}
    {% set attr = attr|merge({
        class: [
            attr.class|default(''),
            class_prefix ~ "__form__input_ccv",
            class_prefix ~ "__form__input",
            'input input_md'
        ]|join(' ')
    }) %}

    {%- set type = type|default('password') -%}
    <input type="{{ type }}" {{ block('widget_attributes') }} {% if value is not empty %}value="{{ value }}" {% endif %}/>

    <span class="ttip__wrap">
        <a href="javascript: void(0);" class="ttip__toggle what-this-link">{{ 'orob2b.payment.methods.whats_this'|trans }}</a>
        <span class="ttip">
            <span class="ttip__content">{{ 'orob2b.payment.methods.tooltip'|trans|nl2br }}</span>
        </span>
    </span>
{% endblock %}

{% block _orob2b_payment_credit_card_widget %}
    {% set options = options|merge({acct: '1234', authorizeTransaction: {}}) %}
    {% set isAuthorizedCard = options.authorizeTransaction is defined and options.acct is defined %}
    {% set componentOptions = {paymentMethod: paymentMethod, authorizedCard: (options.acct is defined ? options.acct : null) } %}
    {% if isAuthorizedCard %}
        <div class="{{ class_prefix }}__form__payment-methods {{ class_prefix }}__form__payment-methods-authorized-card"
             data-page-component-module="orob2bpayment/js/app/components/authorized-credit-card-component"
             data-page-component-options="{{ componentOptions|json_encode }}">
            <p>
                {{ 'orob2b.payment.payflow.authorized_card'|trans({'{{ last4 }}': options.acct}) }}
            </p>
            <a href="javascript: void(0);" data-different-card-handle>{{ 'orob2b.payment.payflow.use_different_card'|trans }}</a>
        </div>
    {% endif %}
    <div class="{{ class_prefix }}__form__payment-methods"
        data-page-component-module="orob2bpayment/js/app/components/credit-card-component"
        data-page-component-options="{{ componentOptions|json_encode }}"
        {{ options.authorizeTransaction is defined and options.acct is defined ? 'style="display: none;"' }}>
        {% if isAuthorizedCard %}
            <div class="{{ class_prefix }}__form__payment-methods-different-card">
                <a href="javascript: void(0);" data-authorized-card-handle>{{ 'orob2b.payment.payflow.cancel_different_card'|trans }}</a>
            </div>
        {% endif %}
        <ul class="{{ class_prefix }}__form__payment-methods__list">
            {% for cc_name in options.allowedCreditCards %}
                <li><i class="credit-card-icon credit-card-icon_{{ cc_name }}"></i></li>
            {% endfor %}
        </ul>
        <div class="{{ class_prefix }}__form__payment-methods__form" data-credit-card-form="data-credit-card-form">
            {% for child in form.children %}
                <div class="{{ class_prefix }}__form__row">
                    {{ form_row(child, {class_prefix: class_prefix}) }}
                </div>
            {% endfor %}
        </div>
    </div>

{% endblock %}
